model EMActivityLogs {
  id         BigInt    @id @default(autoincrement())
  userId     BigInt?   @map("user_id")
  vendorId   BigInt?   @map("vendor_id")
  action     String    @db.VarChar(100)
  entityType String?   @map("entity_type") @db.VarChar(50)
  entityId   BigInt?   @map("entity_id")
  ipAddress  String?   @map("ip_address") @db.VarChar(45)
  userAgent  String?   @map("user_agent") @db.Text
  metadata   Json?
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp

  user   User?      @relation(fields: [userId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  vendor EMVendors? @relation(fields: [vendorId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  @@map("EMActivityLogs")
  @@index([userId])
  @@index([vendorId])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@index([action])
  @@index([userId, action, createdAt])
  @@index([vendorId, action, createdAt])
}

model EMInventoryLogs {
  id               BigInt    @id @default(autoincrement())
  productVariantId BigInt    @map("product_variant_id")
  vendorId         BigInt    @map("vendor_id")
  changeType       String    @map("change_type") @db.VarChar(50)
  quantityBefore   Int       @map("quantity_before")
  quantityChange   Int       @map("quantity_change")
  quantityAfter    Int       @map("quantity_after")
  referenceType    String?   @map("reference_type") @db.VarChar(50)
  referenceId      BigInt?   @map("reference_id")
  notes            String?   @db.Text
  createdBy        BigInt?   @map("created_by")
  createdAt        DateTime? @default(now()) @map("created_at") @db.Timestamp

  productVariant EMProductVariants @relation(fields: [productVariantId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  vendor         EMVendors         @relation(fields: [vendorId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  creator        User?             @relation(fields: [createdBy], references: [id], onDelete: SetNull, onUpdate: Cascade)

  @@map("EMInventoryLogs")
  @@index([productVariantId])
  @@index([vendorId])
  @@index([createdAt])
  @@index([changeType])
}

model EMOrderStatusHistory {
  id                 BigInt    @id @default(autoincrement())
  orderId            BigInt    @map("order_id")
  orderVendorGroupId BigInt    @map("order_vendor_group_id")
  oldStatus          String?   @map("old_status") @db.VarChar(20)
  newStatus          String    @map("new_status") @db.VarChar(20)
  notes              String?   @db.Text
  changedBy          BigInt?   @map("changed_by")
  changedByType      String?   @map("changed_by_type") @db.VarChar(20)
  createdAt          DateTime? @default(now()) @map("created_at") @db.Timestamp

  order            EMOrders            @relation(fields: [orderId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  orderVendorGroup EMOrderVendorGroups @relation(fields: [orderVendorGroupId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  changer          User?               @relation(fields: [changedBy], references: [id], onDelete: SetNull, onUpdate: Cascade)

  @@map("EMOrderStatusHistory")
  @@index([orderId])
  @@index([orderVendorGroupId])
  @@index([createdAt])
}

model EMProductViewLogs {
  id          BigInt    @id @default(autoincrement())
  productId   BigInt    @map("product_id")
  vendorId    BigInt    @map("vendor_id")
  userId      BigInt?   @map("user_id")
  sessionId   String?   @map("session_id") @db.VarChar(255)
  ipAddress   String?   @map("ip_address") @db.VarChar(45)
  referrerUrl String?   @map("referrer_url") @db.VarChar(500)
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamp

  product EMProducts @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  vendor  EMVendors  @relation(fields: [vendorId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  user    User?      @relation(fields: [userId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  @@map("EMProductViewLogs")
  @@index([productId])
  @@index([vendorId])
  @@index([userId])
  @@index([createdAt])
  @@index([productId, createdAt])
  @@index([productId, userId, createdAt])
}

model EMSearchLogs {
  id           BigInt    @id @default(autoincrement())
  userId       BigInt?   @map("user_id")
  sessionId    String?   @map("session_id") @db.VarChar(255)
  query        String    @db.Text
  filters      Json?
  resultsCount Int?      @default(0) @map("results_count")
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamp

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  @@map("EMSearchLogs")
  @@index([userId])
  @@index([createdAt])
}

model EMRateLimitLogs {
  id        BigInt    @id @default(autoincrement())
  userId    BigInt    @map("user_id")
  ipAddress String?   @map("ip_address") @db.VarChar(45)
  endpoint  String?   @db.VarChar(255)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp

  user User @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("EMRateLimitLogs")
  @@index([userId])
  @@index([ipAddress])
  @@index([endpoint])
  @@index([userId, endpoint, createdAt])
}

model EMPlatformSettings {
  id           BigInt    @id @default(autoincrement())
  settingKey   String    @unique @map("setting_key") @db.VarChar(100)
  settingValue String?   @map("setting_value") @db.Text
  settingType  String?   @map("setting_type") @db.VarChar(20)
  description  String?   @db.Text
  updatedAt    DateTime? @default(now()) @map("updated_at") @db.Timestamp

  @@map("EMPlatformSettings")
  @@index([settingKey])
}

model EMTaxCategories {
  id          BigInt    @id @default(autoincrement())
  name        String    @db.VarChar(100)
  description String?   @db.Text
  createdAt   DateTime? @default(now()) @map("created_at") @db.Timestamp

  rules EMTaxRules[]

  @@map("EMTaxCategories")
}

model EMTaxRates {
  id        BigInt    @id @default(autoincrement())
  name      String    @db.VarChar(100)
  rate      Decimal   @db.Decimal(5, 4)
  country   String?   @db.VarChar(2)
  state     String?   @db.VarChar(100)
  isActive  Boolean?  @default(true) @map("is_active")
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp

  rules EMTaxRules[]

  @@map("EMTaxRates")
}

model EMTaxRules {
  id            BigInt @id @default(autoincrement())
  taxCategoryId BigInt @map("tax_category_id")
  taxRateId     BigInt @map("tax_rate_id")
  priority      Int?   @default(0)

  taxCategory EMTaxCategories @relation(fields: [taxCategoryId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  taxRate     EMTaxRates      @relation(fields: [taxRateId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("EMTaxRules")
  @@unique([taxCategoryId, taxRateId])
}

model EMShippingMethods {
  id        BigInt    @id @default(autoincrement())
  vendorId  BigInt?   @map("vendor_id")
  name      String    @db.VarChar(255)
  carrier   String?   @db.VarChar(100)
  isActive  Boolean?  @default(true) @map("is_active")
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp
  updatedAt DateTime? @default(now()) @map("updated_at") @db.Timestamp

  vendor EMVendors? @relation(fields: [vendorId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  rates EMShippingRatesByZone[]

  @@map("EMShippingMethods")
  @@index([vendorId])
  @@index([vendorId, isActive])
}

model EMShippingZones {
  id       BigInt @id @default(autoincrement())
  name     String @db.VarChar(255)
  vendorId BigInt @map("vendor_id")

  vendor EMVendors @relation(fields: [vendorId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  locations EMShippingZoneLocations[]
  rates     EMShippingRatesByZone[]

  @@map("EMShippingZones")
  @@index([vendorId])
}

model EMShippingZoneLocations {
  id             BigInt  @id @default(autoincrement())
  shippingZoneId BigInt  @map("shipping_zone_id")
  country        String? @db.VarChar(2)
  state          String? @db.VarChar(100)
  postalCode     String? @map("postal_code") @db.VarChar(20)

  shippingZone EMShippingZones @relation(fields: [shippingZoneId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("EMShippingZoneLocations")
  @@index([shippingZoneId])
}

model EMShippingRatesByZone {
  id                    BigInt   @id @default(autoincrement())
  shippingMethodId      BigInt   @map("shipping_method_id")
  shippingZoneId        BigInt   @map("shipping_zone_id")
  baseCost              Decimal  @map("base_cost") @db.Decimal(10, 2)
  costPerKg             Decimal? @default(0) @map("cost_per_kg") @db.Decimal(10, 2)
  freeShippingThreshold Decimal? @map("free_shipping_threshold") @db.Decimal(10, 2)
  estimatedDaysMin      Int?     @map("estimated_days_min")
  estimatedDaysMax      Int?     @map("estimated_days_max")

  shippingMethod EMShippingMethods @relation(fields: [shippingMethodId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  shippingZone   EMShippingZones   @relation(fields: [shippingZoneId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("EMShippingRatesByZone")
  @@unique([shippingMethodId, shippingZoneId])
}

model EMLanguages {
  id        Int       @id @default(autoincrement())
  code      String    @unique @db.VarChar(5)
  name      String    @db.VarChar(50)
  isActive  Boolean?  @default(true) @map("is_active")
  isDefault Boolean?  @default(false) @map("is_default")
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp

  vendorTranslations        EMVendorTranslations[]
  categoryTranslations      EMCategoryTranslations[]
  productTranslations       EMProductTranslations[]
  variantTypeTranslations   EMVariantTypeTranslations[]
  variantOptionTranslations EMVariantOptionTranslations[]

  @@map("EMLanguages")
}

model EMExchangeRates {
  id             BigInt    @id @default(autoincrement())
  sourceCurrency String    @map("source_currency") @db.VarChar(3)
  targetCurrency String    @map("target_currency") @db.VarChar(3)
  rate           Decimal   @db.Decimal(12, 6)
  createdAt      DateTime? @default(now()) @map("created_at") @db.Timestamp

  @@map("EMExchangeRates")
  @@unique([sourceCurrency, targetCurrency])
}
